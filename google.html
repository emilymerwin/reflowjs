<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css" href="base.css">

	<script src="packery.pkgd.min.js"></script>
	<script src="miso.ds.deps.ie.min.0.4.1.js"></script>
	<script src="marked.js"></script>
	<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js"></script>


	
	<script type="text/javascript">
		brightcove.createExperiences();
		var obitName = new RegExp(getParameterByName("name"),'i');
		var pckry = {};
		var obitdata = {};
		

		var ds = new Miso.Dataset({
		  //comment out importer to use a local file
		  importer : Miso.Dataset.Importers.GoogleSpreadsheet,
	
		  //change url to correct local file name
		  //comment out url to use google spreadsheets
		  //url: 'curl.jsonp',
		  jsonp: true,
		  parser : Miso.Dataset.Parsers.GoogleSpreadsheet,
		  key : "1AMZOgPH3JQfXafxjmp6J9IUPvDV8IO-cnWURr-u52L8",
		  worksheet : "1"
		});

		ds.fetch({ 
		  success : function() {
		  	obitdata = ds.rows(function(row) {return obitName.test(row.mugshotName)}).toJSON()[0];
		  	init(obitdata);
		  	pckry = new Packery( '#content', {
			  "column": 320,
			  "itemSelector": ".box", 
			  "gutter": 20 ,
			  //"rowHeight": 20,
			  "transitionDuration": "0.0s",	});
			pack();
			var i = setInterval(pack, 100);
			setTimeout(function(){clearInterval(i)},5000);
brightcove.createExperiences();
		  },
		  error : function() {
			console.log("Google data didn't load.");
		  }
		});
		

		
	
		
		function brightcovePlayer(id) {
			html = '<!-- Start of Brightcove Player -->'
// 				+''
// 				+'<div style="display:none">'
// 				+'Janus Single Chromeless Player '
// 				+'</div>'
// 				+''
// 				+'<!--'
// 				+'By use of this code snippet, I agree to the Brightcove Publisher T and C '
// 				+'found at https://accounts.brightcove.com/en/terms-and-conditions/. '
// 				+'-->'
// 				+''
// 				//+'<script language="JavaScript" type="text/javascript" src="http://admin.brightcove.com/js/BrightcoveExperiences.js">\<\/script>'
// 				+''
				+'<object id="myExperience" class="BrightcoveExperience">'
				+'  <param name="bgcolor" value="#FFFFFF" />'
				+'  <param name="width" value="100%" />'
				+'  <param name="height" value="100%" />'
				+'  <param name="playerID" value="2418610043001" />'
				+'  <param name="playerKey" value="AQ~~,AAACLrx-GiE~,-R5NlQaAplIWhlMPcU5YDN5147VaN70m" />'
				+'  <param name="isVid" value="true" />'
				+'  <param name="isUI" value="true" />'
				+'  <param name="dynamicStreaming" value="true" />'
				+''
				+'  <param name="@videoPlayer" value="'+id+'" /> <!-- replace value with video ID -->'
				+'</object>'
// 				+''
// 				+'<!-- '
// 				+'This script tag will cause the Brightcove Players defined above it to be created as soon'
// 				+'as the line is read by the browser. If you wish to have the player instantiated only after'
// 				+'the rest of the HTML is processed and the page load is complete, remove the line.'
// 				+'-->'
// 				//+'<script type="text/javascript">brightcove.createExperiences();\<\/script>'
// 				+''
// 				+'<!-- End of Brightcove Player -->'
		
				return html;
			}
		
		
		function swap(id, content) {
			
			document.getElementById(id).innerHTML=content;
			//new_height = document.getElementById('inner'+id).clientHeight;
			//document.getElementById(id).style.height = new_height + "px";
			//pckry
					
		}
		
		function insert(id, content) {
			document.getElementById(id).innerHTML="<div>"+format(content)+"</div>";
			//new_height = document.getElementById('inner'+id).clientHeight;
			//document.getElementById(id).style.height = new_height + "px";
			//pckry
					
		}
		
		
		
		var boxen = ['bigMultimedia','boxOne','boxTwo','boxThree','boxFour','boxFive','boxSix',
						'boxSeven','boxEight','boxNine','boxTen',"mugshotPhoto",'mugshotBio',];
		var strings = ['bigHeadline', "mugshotName", "mugshotDates",];
		
		function swapLoop(id_list, data, fn) {
			for (i=0; i < id_list.length; i++) {
				val = id_list[i];
				if (data.hasOwnProperty(val)&data[val]!=""&data[val]!=null){
					//console.log(data[val]);
					fn(val, data[val]);
				} else {
				    document.getElementById(val).remove();
				}
			}
		}





		function bgImage(pagedata) {
			if (img.src) {
				bigDiv =  document.getElementById('bigPicture');
				bigDiv.style.backgroundImage = 'url('+pagedata.bigImage+')';
				if (document.body.clientWidth > img.width) {
					bigDiv.style.backgroundSize = 100 + "%";
				} else {
					bigDiv.style.backgroundSize = "";
				}
				
				if (img.height >= 500) {
					bigDiv.style.height = "500px";
				} else if (img.height >= 400) {
					bigDiv.style.height = "400px";
				} else if (img.height >= 300) {
					bigDiv.style.height = "300px";
					
				} else if (img.height >= 250) {
					bigDiv.style.height = "250px";
				} else {
					bigDiv.style.height = "250px";
					bigDiv.style.backgroundSize = 250/img.height * 100 + "%";
				}
			}
		}
		
		function init(pagedata) {
		

			img = new Image();
			if (pagedata.hasOwnProperty('bigImage')&pagedata.bigImage!="") {
				bigDiv =  document.getElementById('bigPicture');
				bigDiv.style.backgroundImage = 'url('+pagedata.bigImage+')';
				img.onload = function () {bgImage(pagedata)};
				img.src = pagedata.bigImage;
				document.getElementById('bigPicture').innerHTML = "<div>" + document.getElementById('bigPicture').innerHTML + "</div>";
			
			window.onresize = function () {bgImage(pagedata)};
			swapLoop(strings, pagedata, swap);
			swapLoop(boxen, pagedata, insert);
			document.body.style.display="";
			} else {}
				
		}

	
		
	


		function pack() {
			pckry.layout();
			//console.log('p');
		}
		
		
		
		function format(text) {
			console.log(text);
			formatted = text;
			var isImage = /^\S*\.(jpg|png|gif)$/;
			var isBrightcove = /http:\/\/bcove.me.*/;
			var isBrightcoveId = /^\d+$/;
			var isYouTube = /http:\/\/(youtu.be)|(youtube.com).*/;
			var isLink = /^(http)?\:\/\/\S+\.\S+\s*$/;
			var isHTML = /^\<.*\>$/;
			if (isImage.test(text)) {
				formatted = "<img src='"+text+"'>";
			} else if (isBrightcove.test(text)) {
				// something
			} else if (isBrightcoveId.test(text)) {
				formatted = brightcovePlayer(text);
				
			} else if (isYouTube.test(text)) {
				//something else
			} else if (isLink.test(text)) {
				// iframe it
			} else if (isHTML.test(text)) {
				formatted = text; // leave it as is
			} else {
				formatted = marked(text);
			}
			return formatted;
		}


		/* parameter getter from james padolsey                                        */
		/* http://james.padolsey.com/javascript/bujs-1-getparameterbyname/             */
		function getParameterByName(name) {
 
			var match = RegExp('[?&]' + name + '=([^&]*)')
                    .exec(window.location.search);
 
			return match ?
				decodeURIComponent(match[1].replace(/\+/g, ' '))
				: null;
 
		}

		
		// name is going to attach a variable to the window. this is not a totally
		// safe way of doing this. eventually will attach these
		function rss(url, name) {
			query = '';
			
		
		
		}


	</script>


 
</head>
<body style="display:none;">
	<div id="bigPicture" class="fullwidth tall"><div><h1 id="bigHeadline"></h1></div></div>
	<div id="content" class="reflow">
			<div class="box" id="mugshot">
				<div id="mugshotPhoto"></div>
				<div id="mugshotCaption">
					<h2 id="mugshotName"></h2>
					<h3 id="mugshotDates"></h3>
					<div class="indentLeft" id="mugshotBio"></div>
				</div>
			</div>
			
			

			<div class="box w2col" id="bigMultimedia"></div>
			<div class="box w2col" id="boxOne"></div>	

			<div class="box w1col" id="boxTwo"></div>
			<div class="box w1col" id="boxThree"></div>
			<div class="box w1col" id="boxFour"></div>
			<div class="box w1col" id="boxFive"></div>

			<div class="box w2col" id="boxSix"></div>
			<div class="box w1col" id="boxSeven"></div>
		 	<div class="box w1col" id="boxEight"></div>
			<div class="box w1col" id="boxNine"></div>
			<div class="box w3col" id="boxTen"></div>


			
	</div>
	
	<script type="text/javascript">
	
	</script>
 
</body>
</html>